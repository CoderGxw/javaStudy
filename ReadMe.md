# java学习笔记  
> <<java多线程编程实战指南-第二版>>

## 基础理论
- Java中的线程分为<b>守护线程</b>（Daemon Thread）和<b>用户线程</b>(User Thread)， 其中用户线程会影响Java虚拟机的正常停止，即java虚拟机停止前所有的用户线程都必须停止。守护线程不影响Java虚拟机的正常停止。
- 线程的属性通常由父线程决定，父线程是守护线程则子线程也是，用户线程同理。也可以通过setDaemon方法来修改。

## 线程的生命周期
![线程生命周期](img/img.png)
- <b>NEW</b>:创建状态，线程刚创建未启动时的状态。一个线程对象只能创建一次，因此一个线程只可能处于该状态一次。
- <b>RUNNABLE</b>:运行状态，该状态包含两个子状态READY和RUNNING，线程被调度时，为RUNNING状态，即线程中的run()中的代码正在CPU中运行，当Thread实例的yield()被调用时，处于READY状态。
- <b>BLOCKED</b>:阻塞状态，当线程被IO阻塞或者被其他线程的锁阻塞时，处于此状态，当阻塞结束后，返回RUNNABLE状态。
- <b>WAITING</b>:无限等待状态，处于等待其他线程执行特定操作的状态。
- <b>TIMED_WAITING</b>:有限等待状态，与WAITING的区别在于，此状态有时间限制，当其他线程没有在指定时间内完成操作时，该线程自动切换为RUNNABLE。
- <b>TERMINATED</b>:结束状态，一个线程只能处于该状态一次。当run() 方法正常返回或异常终止之后，都处于此状态。

注：从RUNNABLE切换到BLOCKED、WAITING、TIMED_WAITING都意味着上下文（Context）切换。

## 原子性
- **概念**：对于涉及共享变量的操作，对外部线程来看是密不可分的，则为原子操作。 
     - 举例：i++不是原子操作，该操作实际可以分为三个子操作：将变量i加载到寄存器中，将寄存器中的值+1，将寄存器中的值写回变量。
- **synchronized**关键字：该关键字可以实现操作的原子性。
   - 原理：该关键字所限定的临界区具有排他性，能保证在任一时刻只有一个线程可以执行该临界区中的代码。